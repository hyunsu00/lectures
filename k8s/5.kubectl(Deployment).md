> ë¦¬ì†ŒìŠ¤ ì œê±°  
> ì‹¤ìŠµì´ ëë‚˜ë©´ delete ëª…ë ¹ì–´ë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ì œê±°í•´ì£¼ì„¸ìš”.

# Deployment

- DeploymentëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ì…ë‹ˆë‹¤. ReplicaSetì„ ì´ìš©í•˜ì—¬ Podì„ ì—…ë°ì´íŠ¸í•˜ê³  ì´ë ¥ì„ ê´€ë¦¬í•˜ì—¬ ë¡¤ë°±Rollbackí•˜ê±°ë‚˜ íŠ¹ì • ë²„ì „revisionìœ¼ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Deployment ë§Œë“¤ê¸°

- typeì„ ì œì™¸í•˜ê³¤ ReplicaSetê³¼ ì™„ì „íˆ ë™ì¼

```yml
# guide/deployment/echo-deployment.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-deploy
spec:
  replicas: 4
  selector:
    matchLabels:
      app: echo
      tier: app
  template:
    metadata:
      labels:
        app: echo
        tier: app
    spec:
      containers:
        - name: echo
          image: ghcr.io/subicura/echo:v1
```

```bash
# Deployment ìƒì„±
kubectl apply -f echo-deployment.yml

# ë¦¬ì†ŒìŠ¤ í™•ì¸
kubectl get po,rs,deploy
```

- Pod ì—…ë°ì´íŠ¸
  > ì—„ë°€íˆ ë§í•˜ë©´ "Podì„ ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•œë‹¤"ëŠ” ê±´ ì˜ëª»ëœ í‘œí˜„ì´ê³ , "ìƒˆë¡œìš´ ë²„ì „ì˜ Podì„ ìƒì„±í•˜ê³  ê¸°ì¡´ Podì„ ì œê±°í•œë‹¤"ê°€ ì •í™•í•œ í‘œí˜„ì…ë‹ˆë‹¤.

```yml
# guide/deployment/echo-deployment-v2.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-deploy
spec:
  replicas: 4
  selector:
    matchLabels:
      app: echo
      tier: app
  template:
    metadata:
      labels:
        app: echo
        tier: app
    spec:
      containers:
        - name: echo
          image: ghcr.io/subicura/echo:v2 # ì´ë¯¸ì§€ íƒœê·¸ë§Œ ë³€ê²½
```

```bash
# ìƒˆë¡œìš´ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
kubectl apply -f echo-deployment-v2.yml

# ë¦¬ì†ŒìŠ¤ í™•ì¸
kubectl get po,rs,deploy

# Deploymentì˜ ìƒì„¸ ìƒíƒœ
kubectl describe deploy/echo-deploy
```

1. DeploymentëŠ” ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¡œ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•´ ReplicaSetì„ ì´ìš©í•©ë‹ˆë‹¤. ë²„ì „ì„ ì—…ë°ì´íŠ¸í•˜ë©´ ìƒˆë¡œìš´ ReplicaSetì„ ìƒì„±í•˜ê³  í•´ë‹¹ ReplicaSetì´ ìƒˆë¡œìš´ ë²„ì „ì˜ Podì„ ìƒì„±í•©ë‹ˆë‹¤.
   ![Deployment](deploy-1.291861bf.png)
2. ìƒˆë¡œìš´ ReplicaSetì„ 0 -> 1ê°œë¡œ ì¡°ì •í•˜ê³  ì •ìƒì ìœ¼ë¡œ Podì´ ë™ì‘í•˜ë©´ ê¸°ì¡´ ReplicaSetì„ 4 -> 3ê°œë¡œ ì¡°ì •í•©ë‹ˆë‹¤.
   ![Deployment](deploy-2.9a98dc68.png)
3. ìƒˆë¡œìš´ ReplicaSetì„ 1 -> 2ê°œë¡œ ì¡°ì •í•˜ê³  ì •ìƒì ìœ¼ë¡œ Podì´ ë™ì‘í•˜ë©´ ê¸°ì¡´ ReplicaSetì„ 3 -> 2ê°œë¡œ ì¡°ì •í•©ë‹ˆë‹¤.
   ![Deployment](deploy-3.8b5491c5.png)
4. ìƒˆë¡œìš´ ReplicaSetì„ 2 -> 3ê°œë¡œ ì¡°ì •í•˜ê³  ì •ìƒì ìœ¼ë¡œ Podì´ ë™ì‘í•˜ë©´ ê¸°ì¡´ ReplicaSetì„ 2 -> 1ê°œë¡œ ì¡°ì •í•©ë‹ˆë‹¤.
   ![Deployment](deploy-4.680a0d2d.png)
5. ìµœì¢…ì ìœ¼ë¡œ ìƒˆë¡œìš´ ReplicaSetì„ 4ê°œë¡œ ì¡°ì •í•˜ê³  ì •ìƒì ìœ¼ë¡œ Podì´ ë™ì‘í•˜ë©´ ê¸°ì¡´ ReplicaSetì„ 0ê°œë¡œ ì¡°ì •í•©ë‹ˆë‹¤. ğŸ‰ ì—…ë°ì´íŠ¸ ì™„ë£Œ!
   ![Deployment](deploy-5.0b85d0bc.png)
6. ë™ì‘ë°©ì‹
   ![Deployment](deploy-6.png)

   1. Deployment ControllerëŠ” Deploymentì¡°ê±´ì„ ê°ì‹œí•˜ë©´ì„œ í˜„ì¬ ìƒíƒœì™€ ì›í•˜ëŠ” ìƒíƒœê°€ ë‹¤ë¥¸ ê²ƒì„ ì²´í¬
   2. Deployment Controllerê°€ ì›í•˜ëŠ” ìƒíƒœê°€ ë˜ë„ë¡ ReplicaSet ì„¤ì •
   3. ReplicaSet ControllerëŠ” ReplicaSetì¡°ê±´ì„ ê°ì‹œí•˜ë©´ì„œ í˜„ì¬ ìƒíƒœì™€ ì›í•˜ëŠ” ìƒíƒœê°€ ë‹¤ë¥¸ ê²ƒì„ ì²´í¬
   4. ReplicaSet Controllerê°€ ì›í•˜ëŠ” ìƒíƒœê°€ ë˜ë„ë¡ Podì„ ìƒì„±í•˜ê±°ë‚˜ ì œê±°
   5. SchedulerëŠ” APIì„œë²„ë¥¼ ê°ì‹œí•˜ë©´ì„œ í• ë‹¹ë˜ì§€ ì•Šì€unassigned Podì´ ìˆëŠ”ì§€ ì²´í¬
   6. SchedulerëŠ” í• ë‹¹ë˜ì§€ ì•Šì€ ìƒˆë¡œìš´ Podì„ ê°ì§€í•˜ê³  ì ì ˆí•œ ë…¸ë“œnodeì— ë°°ì¹˜
   7. ì´í›„ ë…¸ë“œëŠ” ê¸°ì¡´ëŒ€ë¡œ ë™ì‘

   DeploymentëŠ” Deployment Controllerê°€ ê´€ë¦¬í•˜ê³  ReplicaSetê³¼ Podì€ ê¸°ì¡´ Controllerì™€ Schedulerê°€ ê´€ë¦¬í•©ë‹ˆë‹¤.

## ë²„ì „ê´€ë¦¬

```bash
# íˆìŠ¤í† ë¦¬ í™•ì¸
kubectl rollout history deploy/echo-deploy

# revision 1 íˆìŠ¤í† ë¦¬ ìƒì„¸ í™•ì¸
kubectl rollout history deploy/echo-deploy --revision=1

# ë°”ë¡œ ì „ìœ¼ë¡œ ë¡¤ë°±
kubectl rollout undo deploy/echo-deploy

# íŠ¹ì • ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
kubectl rollout undo deploy/echo-deploy --to-revision=2

# Deployment ì œê±°
kubectl delete -f echo-deployment-v2.yml
```

## ë°°í¬ ì „ëµ ì„¤ì •

- Deployment ë‹¤ì–‘í•œ ë°©ì‹ì˜ ë°°í¬ ì „ëµì´ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„  ë¡¤ë§ì—…ë°ì´íŠ¸**RollingUpdate** ë°©ì‹ì„ ì‚¬ìš©í•  ë•Œ ë™ì‹œì— ì—…ë°ì´íŠ¸í•˜ëŠ” Podì˜ ê°œìˆ˜ë¥¼ ë³€ê²½í•´ë³´ê² ìŠµë‹ˆë‹¤.

```yml
# guide/deployment/echo-strategy.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-deploy-st
spec:
  replicas: 4
  selector:
    matchLabels:
      app: echo
      tier: app
  minReadySeconds: 5
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 3
      maxUnavailable: 3
  template:
    metadata:
      labels:
        app: echo
        tier: app
    spec:
      containers:
        - name: echo
          image: ghcr.io/subicura/echo:v1
          livenessProbe:
            httpGet:
              path: /
              port: 3000
```

```bash
# Deployment ìƒì„±
kubectl apply -f echo-strategy.yml

# ë¦¬ì†ŒìŠ¤ í™•ì¸
kubectl get po,rs,deploy

# ì´ë¯¸ì§€ ë³€ê²½ (ëª…ë ¹ì–´ë¡œ)
kubectl set image deploy/echo-deploy-st echo=ghcr.io/subicura/echo:v2

# ì´ë²¤íŠ¸ í™•ì¸
kubectl describe deploy/echo-deploy-st

# Deployment ì œê±°
kubectl delete -f echo-strategy.yml
```

> ë°°í¬ ì „ëµ  
> maxSurgeì™€ maxUnavailableì˜ ê¸°ë³¸ê°’ì€ 25%ì…ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ìƒí™©ì—ì„œ ì ë‹¹í•˜ì§€ë§Œ ìƒí™©ì— ë”°ë¼ ì ì ˆí•˜ê²Œ ì¡°ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

## ë§ˆë¬´ë¦¬

DeploymentëŠ” ê°€ì¥ í”í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ë°°í¬ë°©ì‹ì…ë‹ˆë‹¤. ì´ì™¸ì— **StatefulSet**, **DaemonSet**, **CronJob**, **Job**ë“±ì´ ìˆì§€ë§Œ ì‚¬ìš©ë²•ì€ í¬ê²Œ ë‹¤ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.

## ë¬¸ì œ

### ë¬¸ì œ1

| í‚¤                | ê°’           |
| ----------------- | ------------ |
| Deployment ì´ë¦„   | nginx        |
| Deployment Label  | app: nginx   |
| Deployment ë³µì œìˆ˜ | 3            |
| Container ì´ë¦„    | nginx        |
| Container ì´ë¯¸ì§€  | nginx:1.14.2 |

```yml
# guide/deployment/deploy_exam1.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
        - name: nginx
          image: nginx:1.14.2
```

### ë¬¸ì œ2

```yml
# guide/deployment/deploy_exam2.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: 5 # ë¬¸ì œ1ì—ì„œ ìˆ˜ì •
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
        - name: nginx
          image: nginx:1.14.2
```

### ë¬¸ì œ3

```yml
# guide/deployment/deploy_exam3.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: 5
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
        - name: nginx
          image: nginx:1.19.5 # ë¬¸ì œ2ì—ì„œ ìˆ˜ì •
```
